{{ ansible_managed | comment }}
#
# /etc/sudoers.d/aide-unprivileged
#
Cmnd_Alias C_AIDE = \
{% if ansible_distribution == 'Ubuntu' and ansible_distribution_major_version | int < 22 %}
   /usr/sbin/update-aide.conf, \
   /usr/bin/aide.wrapper --update, \
   /usr/bin/install -o _aide -m 600 /var/lib/aide/aide.conf.autogenerated /run/aide/aide.conf.autogenerated, \
{% else %}
   /usr/bin/aide --config=/etc/aide/aide.conf --update, \
{% endif %}
   /usr/bin/stat -c %y /var/lib/aide/aide.db, \
   /usr/bin/savelog -c 7 /var/lib/aide/aide.db, \
   /usr/bin/install -d -o _aide -g root -m 700 /run/aide, \
   /bin/cp -f /var/lib/aide/aide.db.new /var/lib/aide/aide.db

#   /usr/bin/savelog -t -g adm -m 640 -u root -c 7 /var/log/aide/aide.log

{{ harden_aide_user }} ALL = (root) NOPASSWD: C_AIDE
